# Überlegungen und Ansätze

## Historische Daten

Basierend auf openligadb:
- ["bl1", "bl2"],
- [2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017]

### Torwahrscheinlichkeiten nach Zeitraum

| Zeitinterval | Total | Prozentual |
|----------------|-------|------------|
| 00-05         | 648  | 5.85%      |
| 05-10         | 540  | 4.88%      |
| 10-15         | 594  | 5.37%      |
| 15-20         | 486  | 4.39%      |
| 20-25         | 450  | 4.07%      |
| 25-30         | 504  | 4.55%      |
| 30-35         | 504  | 4.55%      |
| 35-40         | 567  | 5.12%      |
| 40-45         | 504  | 4.55%      |
| 45-50         | 639  | 5.77%      |
| 50-55         | 576  | 5.20%      |
| 55-60         | 774  | 6.99%      |
| 60-65         | 504  | 4.55%      |
| 65-70         | 675  | 6.10%      |
| 70-75         | 621  | 5.61%      |
| 75-80         | 639  | 5.77%      |
| 80-85         | 657  | 5.93%      |
| 85-90         | 711  | 6.42%      |
| 90-OT         | 477  | 4.31%      |

### Torwahrscheinlichkeiten nach Zeitraum und Heim/Auswärts
| **Time Interval** | **H** | **H%** | **A** | **A%** |
| --- | --- | --- | --- | --- |
| 00-05 | 351 | 3.17% | 297 | 2.76% |
| 05-10 | 306 | 2.76% | 234 | 2.21% |
| 10-15 | 342 | 3.09% | 252 | 2.36% |
| 15-20 | 306 | 2.76% | 180 | 1.67% |
| 20-25 | 270 | 2.44% | 180 | 1.67% |
| 25-30 | 189 | 1.71% | 315 | 2.90% |
| 30-35 | 243 | 2.20% | 261 | 2.45% |
| 35-40 | 279 | 2.52% | 288 | 2.72% |
| 40-45 | 252 | 2.28% | 252 | 2.28% |
| 45-50 | 333 | 3.01% | 306 | 2.86% |
| 50-55 | 297 | 2.68% | 279 | 2.63% |
| 55-60 | 432 | 3.90% | 342 | 3.20% |
| 60-65 | 288 | 2.60% | 216 | 1.99% |
| 65-70 | 369 | 3.33% | 306 | 2.87% |
| 70-75 | 288 | 2.60% | 333 | 3.11% |
| 75-80 | 378 | 3.41% | 261 | 2.44% |
| 80-85 | 441 | 3.98% | 216 | 1.96% |
| 85-90 | 369 | 3.33% | 342 | 3.16% |
| 90-OT | 234 | 2.11% | 243 | 2.26% |

### Torwahrscheinlichkeiten nach Zeitraum und Heim/Auswärts und Spielsituation
| Time Interval | -5            | -4            | -3            | -2            | -1            | 0             | 1             | 2             | 3             | 4             | 5             |
|---------------|---------------|---------------|---------------|---------------|---------------|---------------|---------------|---------------|---------------|---------------|---------------|
| 00-05         | 0.00%-0.00%   | 0.00%-0.00%   | 0.08%-0.00%   | 0.08%-0.08%   | 0.24%-0.16%   | 2.36%-2.20%   | 0.24%-0.24%   | 0.08%-0.00%   | 0.08%-0.00%   | 0.00%-0.00%   | 0.00%-0.00%   |
| 05-10         | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.00%   | 0.24%-0.16%   | 2.28%-1.87%   | 0.24%-0.08%   | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.00%   |
| 10-15         | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.00%   | 0.49%-0.33%   | 2.03%-1.87%   | 0.49%-0.08%   | 0.08%-0.00%   | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.00%   |
| 15-20         | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.08%   | 0.41%-0.24%   | 1.71%-1.06%   | 0.49%-0.08%   | 0.16%-0.16%   | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.00%   |
| 20-25         | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.00%   | 0.08%-0.00%   | 0.41%-0.24%   | 0.98%-1.06%   | 0.89%-0.16%   | 0.08%-0.08%   | 0.00%-0.08%   | 0.00%-0.00%   | 0.00%-0.00%   |
| 25-30         | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.24%   | 0.49%-0.41%   | 0.89%-1.63%   | 0.24%-0.49%   | 0.08%-0.00%   | 0.00%-0.08%   | 0.00%-0.00%   | 0.00%-0.00%   |
| 30-35         | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.08%   | 0.00%-0.00%   | 0.57%-0.73%   | 0.81%-1.22%   | 0.65%-0.33%   | 0.16%-0.00%   | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.00%   |
| 35-40         | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.24%   | 0.24%-0.24%   | 1.38%-1.38%   | 0.57%-0.41%   | 0.33%-0.24%   | 0.00%-0.08%   | 0.00%-0.00%   | 0.00%-0.00%   |
| 40-45         | 0.00%-0.00%   | 0.00%-0.00%   | 0.08%-0.08%   | 0.16%-0.24%   | 0.41%-0.41%   | 1.30%-0.98%   | 0.24%-0.49%   | 0.08%-0.00%   | 0.00%-0.08%   | 0.00%-0.00%   | 0.00%-0.00%   |
| 45-50         | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.08%   | 0.49%-0.57%   | 1.87%-1.14%   | 0.57%-0.57%   | 0.08%-0.24%   | 0.00%-0.16%   | 0.00%-0.00%   | 0.00%-0.00%   |
| 50-55         | 0.00%-0.00%   | 0.00%-0.00%   | 0.16%-0.08%   | 0.41%-0.16%   | 0.33%-0.65%   | 0.98%-0.73%   | 0.81%-0.57%   | 0.00%-0.33%   | 0.00%-0.00%   | 0.00%-0.00%   | 0.00%-0.00%   |
| 55-60         | 0.00%-0.00%   | 0.08%-0.16%   | 0.08%-0.08%   | 0.00%-0.49%   | 1.14%-0.41%   | 1.14%-1.46%   | 0.81%-0.24%   | 0.57%-0.16%   | 0.08%-0.08%   | 0.00%-0.00%   | 0.00%-0.00%   |
| 60-65         | 0.00%-0.00%   | 0.00%-0.08%   | 0.08%-0.00%   | 0.08%-0.00%   | 0.65%-0.33%   | 0.65%-0.81%   | 0.57%-0.41%   | 0.33%-0.33%   | 0.24%-0.00%   | 0.00%-0.00%   | 0.00%-0.00%   |
| 65-70         | 0.00%-0.00%   | 0.08%-0.00%   | 0.00%-0.33%   | 0.24%-0.08%   | 0.49%-0.49%   | 0.98%-0.65%   | 0.81%-0.73%   | 0.49%-0.33%   | 0.24%-0.16%   | 0.00%-0.00%   | 0.00%-0.00%   |
| 70-75         | 0.08%-0.00%   | 0.00%-0.08%   | 0.00%-0.16%   | 0.24%-0.33%   | 0.49%-0.65%   | 0.73%-0.98%   | 0.73%-0.24%   | 0.24%-0.49%   | 0.08%-0.00%   | 0.00%-0.08%   | 0.00%-0.00%   |
| 75-80         | 0.08%-0.00%   | 0.00%-0.00%   | 0.08%-0.08%   | 0.41%-0.24%   | 0.57%-0.33%   | 0.81%-0.73%   | 0.73%-0.73%   | 0.49%-0.16%   | 0.16%-0.00%   | 0.08%-0.00%   | 0.00%-0.08%   |
| 80-85         | 0.00%-0.08%   | 0.16%-0.00%   | 0.16%-0.16%   | 0.41%-0.24%   | 0.73%-0.33%   | 1.06%-0.73%   | 0.65%-0.00%   | 0.65%-0.33%   | 0.08%-0.08%   | 0.08%-0.00%   | 0.00%-0.00%   |
| 85-90         | 0.00%-0.00%   | 0.08%-0.00%   | 0.00%-0.16%   | 0.16%-0.16%   | 0.73%-0.49%   | 0.41%-0.81%   | 1.06%-0.81%   | 0.57%-0.57%   | 0.24%-0.08%   | 0.00%-0.00%   | 0.08%-0.00%   |
| 90-OT         | 0.00%-0.00%   | 0.00%-0.00%   | 0.08%-0.16%   | 0.24%-0.16%   | 0.73%-0.65%   | 0.08%-0.73%   | 0.89%-0.16%   | 0.08%-0.16%   | 0.00%-0.08%   | 0.00%-0.08%   | 0.00%-0.00%   |

## Historische Übergangswahrscheinlichkeiten nach Zeitslot und Spielsituation
| Time Interval | Count | +/- | -1 | 0 | 1 |
|---------------|-------|-----|----|---|---|
| 00-05         | 5508  | 0   | 4.08% | 91.50% | 4.41% |
| 05-10         | 216   | -1  | 4.17% | 83.33% | 12.50% |
| 05-10         | 5040  | 0   | 4.11% | 90.89% | 5.00% |
| 05-10         | 243   | 1   | 3.70% | 88.89% | 7.41% |
| 10-15         | 387   | -1  | 9.30% | 79.07% | 11.63% |
| 10-15         | 4617  | 0   | 4.48% | 90.84% | 4.68% |
| 10-15         | 468   | 1   | 1.92% | 90.38% | 7.69% |
| 15-20         | 513   | -1  | 5.26% | 85.96% | 8.77% |
| 15-20         | 4248  | 0   | 2.75% | 93.01% | 4.24% |
| 15-20         | 639   | 1   | 1.41% | 90.14% | 8.45% |
| 20-25         | 558   | -1  | 4.84% | 87.10% | 8.06% |
| 20-25         | 4005  | 0   | 2.92% | 94.38% | 2.70% |
| 20-25         | 765   | 1   | 2.35% | 84.71% | 12.94% |
| 25-30         | 612   | -1  | 7.35% | 83.82% | 8.82% |
| 25-30         | 3843  | 0   | 4.68% | 92.51% | 2.81% |
| 25-30         | 765   | 1   | 5.88% | 90.59% | 3.53% |
| 25-30         | 171   | 2   | 0.00% | 94.74% | 5.26% |
| 30-35         | 117   | -2  | 0.00% | 100.00% | 0.00% |
| 30-35         | 693   | -1  | 10.39% | 80.52% | 9.09% |
| 30-35         | 3654  | 0   | 3.94% | 93.60% | 2.46% |
| 30-35         | 801   | 1   | 3.37% | 88.76% | 7.87% |
| 30-35         | 198   | 2   | 0.00% | 95.45% | 4.55% |
| 35-40         | 189   | -2  | 14.29% | 85.71% | 0.00% |
| 35-40         | 702   | -1  | 3.85% | 92.31% | 3.85% |
| 35-40         | 3510  | 0   | 4.10% | 91.54% | 4.36% |
| 35-40         | 801   | 1   | 5.62% | 86.52% | 7.87% |
| 35-40         | 252   | 2   | 10.71% | 75.00% | 14.29% |
| 40-45         | 189   | -2  | 14.29% | 80.95% | 4.76% |
| 40-45         | 792   | -1  | 5.68% | 88.64% | 5.68% |
| 40-45         | 3285  | 0   | 3.01% | 92.88% | 4.11% |
| 40-45         | 873   | 1   | 5.15% | 91.75% | 3.09% |
| 40-45         | 252   | 2   | 0.00% | 100.00% | 0.00% |
| 45-50         | 207   | -2  | 4.35% | 95.65% | 0.00% |
| 45-50         | 810   | -1  | 8.89% | 85.56% | 5.56% |
| 45-50         | 3141  | 0   | 3.44% | 90.83% | 5.73% |
| 45-50         | 936   | 1   | 5.77% | 87.50% | 6.73% |
| 45-50         | 288   | 2   | 9.38% | 87.50% | 3.13% |
| 50-55         | 270   | -2  | 6.67% | 80.00% | 13.33% |
| 50-55         | 801   | -1  | 8.99% | 86.52% | 4.49% |
| 50-55         | 2952  | 0   | 2.74% | 93.90% | 3.35% |
| 50-55         | 1026  | 1   | 5.26% | 86.84% | 7.89% |
| 50-55         | 324   | 2   | 5.56% | 94.44% | 0.00% |
| 55-60         | 297   | -2  | 15.15% | 84.85% | 0.00% |
| 55-60         | 819   | -1  | 4.40% | 83.52% | 12.09% |
| 55-60         | 2862  | 0   | 5.03% | 90.57% | 4.40% |
| 55-60         | 999   | 1   | 2.70% | 87.39% | 9.91% |
| 55-60         | 387   | 2   | 4.65% | 83.72% | 11.63% |
| 60-65         | 297   | -2  | 0.00% | 96.97% | 3.03% |
| 60-65         | 828   | -1  | 5.43% | 89.13% | 5.43% |
| 60-65         | 2718  | 0   | 2.98% | 94.37% | 2.65% |
| 60-65         | 1017  | 1   | 3.54% | 91.15% | 5.31% |
| 60-65         | 423   | 2   | 8.51% | 82.98% | 8.51% |
| 65-70         | 333   | -2  | 2.70% | 89.19% | 8.11% |
| 65-70         | 828   | -1  | 5.43% | 86.96% | 7.61% |
| 65-70         | 2646  | 0   | 2.38% | 93.54% | 4.08% |
| 65-70         | 1035  | 1   | 6.96% | 86.96% | 6.09% |
| 65-70         | 405   | 2   | 6.67% | 80.00% | 13.33% |
| 65-70         | 117   | 3   | 7.69% | 69.23% | 23.08% |
| 70-75         | 342   | -2  | 10.53% | 81.58% | 7.89% |
| 70-75         | 810   | -1  | 6.67% | 86.67% | 6.67% |
| 70-75         | 2610  | 0   | 2.07% | 95.17% | 2.76% |
| 70-75         | 1035  | 1   | 2.61% | 89.57% | 7.83% |
| 70-75         | 396   | 2   | 13.64% | 81.82% | 4.55% |
| 70-75         | 135   | 3   | 0.00% | 93.33% | 6.67% |
| 75-80         | 333   | -2  | 8.11% | 78.38% | 13.51% |
| 75-80         | 783   | -1  | 2.30% | 90.80% | 6.90% |
| 75-80         | 2565  | 0   | 2.81% | 93.68% | 3.51% |
| 75-80         | 1053  | 1   | 5.98% | 87.18% | 6.84% |
| 75-80         | 405   | 2   | 4.44% | 84.44% | 11.11% |
| 75-80         | 144   | 3   | 0.00% | 93.75% | 6.25% |
| 80-85         | 108   | -3  | 16.67% | 66.67% | 16.67% |
| 80-85         | 288   | -2  | 3.13% | 81.25% | 15.63% |
| 80-85         | 828   | -1  | 4.35% | 86.96% | 8.70% |
| 80-85         | 2520  | 0   | 3.21% | 92.50% | 4.29% |
| 80-85         | 1026  | 1   | 0.00% | 94.74% | 5.26% |
| 80-85         | 414   | 2   | 8.70% | 73.91% | 17.39% |
| 80-85         | 180   | 3   | 5.00% | 90.00% | 5.00% |
| 85-90         | 288   | -2  | 6.25% | 87.50% | 6.25% |
| 85-90         | 846   | -1  | 4.26% | 86.17% | 9.57% |
| 85-90         | 2403  | 0   | 3.37% | 95.13% | 1.50% |
| 85-90         | 1116  | 1   | 8.06% | 83.06% | 8.87% |
| 85-90         | 369   | 2   | 12.20% | 73.17% | 14.63% |
| 85-90         | 234   | 3   | 3.85% | 84.62% | 11.54% |
| 90-OT         | 126   | -3  | 14.29% | 78.57% | 7.14% |
| 90-OT         | 288   | -2  | 6.25% | 87.50% | 6.25% |
| 90-OT         | 828   | -1  | 6.52% | 86.96% | 6.52% |
| 90-OT         | 2457  | 0   | 2.56% | 96.70% | 0.73% |
| 90-OT         | 1008  | 1   | 1.79% | 90.18% | 8.04% |
| 90-OT         | 378   | 2   | 2.38% | 95.24% | 2.38% |
| 90-OT         | 252   | 3   | 0.00% | 100.00% | 0.00% |

## Konzept mit Übergangswahrscheinlichkeiten und Risikoverhaten nach Spielsituation und Restzeit

Um das Modell für jedes Team individuell zu kalibrieren, sollten verschiedene Faktoren berücksichtigt werden, die das Teamverhalten beeinflussen. Das Kalibrieren auf Teamniveau bedeutet, dass die Übergangswahrscheinlichkeiten \( P_t \) speziell für jedes Team angepasst werden, abhängig von deren Spielstärke, Heimvorteil, Risikoverhalten und anderen relevanten Faktoren. Hier ist ein detaillierter Ansatz:

### **1. Kalibrierung der Übergangswahrscheinlichkeiten pro Team**
Die Übergangswahrscheinlichkeiten \( P_{\text{team}}(\Delta_{t+1} | \Delta_t) \) sollten spezifisch für jedes Team angepasst werden. Das kann auf Basis historischer Daten, Teamstärken und Spielstil erfolgen. Die Schritte zur Kalibrierung sind:

---

### **2. Historische Daten und Teamstärken**
- **Teamstärke (Attack & Defense):** Jedes Team hat eine bestimmte durchschnittliche Offensiv- und Defensivstärke. Dies kann aus historischen Daten (z. B. Tore pro Spiel, Gegentore pro Spiel) abgeleitet werden.  
  - **Offensive Stärke (\( \lambda_{\text{attack}} \))**: Wie viele Tore ein Team in einem durchschnittlichen Spiel erzielt.  
  - **Defensive Stärke (\( \lambda_{\text{defense}} \))**: Wie viele Tore ein Team im Durchschnitt zulässt.

- **Heimvorteil für jedes Team:** Jedes Team hat möglicherweise einen unterschiedlichen Heimvorteil. Um diesen zu berücksichtigen, sollte für jedes Team ein spezifischer Heimvorteilsfaktor \( \alpha_H \) und Auswärtsnachteil \( \alpha_A \) festgelegt werden.

---

### **3. Risikoverhalten anpassen**
Das Risikoverhalten sollte je nach Team variieren:
- **Risikofaktor (bei Rückstand):** Teams reagieren unterschiedlich auf Rückstände, indem sie risikoreicher spielen. Einige Teams, die aggressiv spielen, erhöhen ihre Wahrscheinlichkeit für Tore (aber auch für Gegentore). Andere Teams könnten sich defensiver verhalten.

- **Berechnung des Risikofaktors:** Ein Team mit einer stärkeren Offensivausrichtung wird seinen Risikofaktor \( R_t \) eher erhöhen als ein defensiv orientiertes Team.

---

### **4. Kalibrierung der Übergangsmatrix für jedes Team**
Jedes Team wird eine eigene Übergangsmatrix erhalten, die auf dessen spezifischen Eigenschaften basiert. Hierzu können die folgenden Schritte verwendet werden:

1. **Bestimmung der Offensiv- und Defensivstärken:**
   \[
   \lambda_{\text{attack}} = \frac{\text{durchschnittliche Tore des Teams pro Spiel}}{T}
   \]
   \[
   \lambda_{\text{defense}} = \frac{\text{durchschnittliche Gegentore des Teams pro Spiel}}{T}
   \]

2. **Heim- und Auswärtsfaktoren für jedes Team:**
   \[
   \alpha_H = \text{Heimvorteil des Teams}
   \]
   \[
   \alpha_A = \text{Auswärtsnachteil des Teams}
   \]

3. **Berechnung der Übergangswahrscheinlichkeiten für jedes Team:**
   \[
   P_{\text{team}}(\Delta_{t+1} = \Delta_t + 1 | t) = \lambda_{\text{attack}} \cdot \alpha_H
   \]
   \[
   P_{\text{team}}(\Delta_{t+1} = \Delta_t - 1 | t) = \lambda_{\text{defense}} \cdot \alpha_A
   \]

4. **Risiko bei Rückstand:**  
   Bei einem Rückstand wird der Risikofaktor \( R_t \) angewendet. Der Risikofaktor variiert je nach Team:
   \[
   P_{\text{team}}(\Delta_{t+1} = \Delta_t + 1 | \Delta_t < 0) = R_t \cdot \lambda_{\text{attack}} \cdot \alpha_H
   \]
   \[
   P_{\text{team}}(\Delta_{t+1} = \Delta_t - 1 | \Delta_t < 0) = R_t \cdot \lambda_{\text{defense}} \cdot \alpha_A
   \]

---

### **5. Beispiel: Kalibrierung für Heim- und Auswärtsteam**
Angenommen, wir haben zwei Teams:  
- **Team A (Heimteam)**: \( \lambda_{\text{attack}} = 1.5 \), \( \lambda_{\text{defense}} = 1.0 \), \( \alpha_H = 1.2 \), \( \alpha_A = 0.8 \)  
- **Team B (Auswärtsteam)**: \( \lambda_{\text{attack}} = 1.2 \), \( \lambda_{\text{defense}} = 1.2 \), \( \alpha_H = 1.1 \), \( \alpha_A = 1.0 \)

Für Team A (Heimteam) in einem Rückstand (\( \Delta_t = -1 \)) mit Risikofaktor \( R_t = 1.5 \) (sehr risikofreudig):
- **Wahrscheinlichkeit, dass Team A ein Tor schießt (Rückstand)**:  
  \[
  P(\Delta_{t+1} = 0 | \Delta_t = -1) = 1.5 \times 1.5 \times 1.2 = 2.7
  \]

- **Wahrscheinlichkeit, dass Team A ein Gegentor kassiert (Rückstand)**:  
  \[
  P(\Delta_{t+1} = -2 | \Delta_t = -1) = 1.5 \times 1.0 \times 0.8 = 1.2
  \]

Diese Wahrscheinlichkeiten werden dann normalisiert und auf die Übergangsmatrix angewendet.

---

### **6. Python-Code zur Kalibrierung für jedes Team**

Hier ist ein Python-Code, der die oben beschriebenen Schritte für die Kalibrierung von Übergangswahrscheinlichkeiten pro Team umsetzt:

```python
# Teamstärken und Parameter für Heim/Auswärts
teams = {
    "TeamA": {"attack": 1.5, "defense": 1.0, "alpha_H": 1.2, "alpha_A": 0.8},
    "TeamB": {"attack": 1.2, "defense": 1.2, "alpha_H": 1.1, "alpha_A": 1.0},
}

# Risikofaktor berechnen
def risk_factor(t, T, beta=0.5):
    return 1 + beta * (T - t) / T

# Übergangswahrscheinlichkeiten pro Team kalibrieren
def calibrate_team_transition_matrix(team, t, T, delta_t, is_home):
    # Teamdaten
    attack = team["attack"]
    defense = team["defense"]
    alpha_H = team["alpha_H"]
    alpha_A = team["alpha_A"]
    
    # Risikofaktor
    R_t = risk_factor(t, T)
    
    # Übergangswahrscheinlichkeiten für jedes Team
    P_modified = np.array([0.0, 0.0, 0.0])  # P(Delta_t = -1, 0, +1)

    # Heimvorteil und Risikoverhalten anwenden
    if is_home:
        P_modified[2] = attack * alpha_H  # Wahrscheinlichkeit für Tor
    else:
        P_modified[0] = defense * alpha_A  # Wahrscheinlichkeit für Gegentor
    
    # Risikoverhalten anpassen bei Rückstand
    if delta_t < 0:  # Team ist im Rückstand
        P_modified[2] *= R_t  # Risiko für Tor steigt
        P_modified[0] *= R_t  # Risiko für Gegentor steigt

    # Normierung der Wahrscheinlichkeiten
    P_modified /= P_modified.sum()

    return P_modified

# Beispiel: Kalibrierung für TeamA (Heimteam) bei Rückstand
T = 20  # 20 Zeitslots
delta_t = -1  # Rückstand
t = 5  # Zeitpunkt im Spiel
is_home = True  # Team A ist Heimteam

P_teamA = calibrate_team_transition_matrix(teams["TeamA"], t, T, delta_t, is_home)
P_teamA
```

---

### **7. Fazit und Anwendung**
- Du kannst die Übergangswahrscheinlichkeiten individuell für jedes Team anhand von dessen historischer Spielstärke und spezifischen Eigenschaften (Heimvorteil, Risikoverhalten) anpassen.
- Die Kalibrierung erfolgt durch die Berücksichtigung der Offensiv- und Defensivstärke sowie von Zeit- und Spielsituationsfaktoren.
  
Möchtest du diesen Code weiter anpassen oder eine Simulation auf dieser Basis durchführen?


Um die Methode zur Berechnung und Verwendung von \( \alpha \) basierend auf \( \lambda \) zu spezifizieren, könnten wir die folgenden Aspekte genauer betrachten:

---

## Lambda & Alpha sauber separiert

### **1. Detaillierter Ansatz zur Kalibrierung von \( \lambda \) und \( \alpha \):**

#### **1.1 Schätzung von \( \lambda_{\text{team,heim}} \) und \( \lambda_{\text{team,auswärts}}**
\( \lambda_{\text{team,heim}} \) und \( \lambda_{\text{team,auswärts}} \) können durch historische Daten geschätzt werden. Dies erfolgt durch die Mittelwerte der erzielten Tore (Offensivstärke) und der zugelassenen Tore (Defensivstärke):

\[
\lambda_{\text{team,heim,attack}} = \frac{\text{Summe erzielter Tore in Heimspielen}}{\text{Anzahl Heimspiele}}
\]

\[
\lambda_{\text{team,auswärts,attack}} = \frac{\text{Summe erzielter Tore in Auswärtsspielen}}{\text{Anzahl Auswärtsspiele}}
\]

Analog wird die Defensivstärke berechnet:

\[
\lambda_{\text{team,heim,defense}} = \frac{\text{Summe zugelassener Tore in Heimspielen}}{\text{Anzahl Heimspiele}}
\]

\[
\lambda_{\text{team,auswärts,defense}} = \frac{\text{Summe zugelassener Tore in Auswärtsspielen}}{\text{Anzahl Auswärtsspiele}}
\]

---

#### **1.2 Berechnung der durchschnittlichen \( \lambda_{\text{avg}} \):**
Die durchschnittlichen Werte aller Teams geben eine Referenz:

\[
\lambda_{\text{avg,heim,attack}} = \frac{\sum_{i=1}^{n} \lambda_{\text{team}_i, \text{heim,attack}}}{n}
\]
\[
\lambda_{\text{avg,auswärts,attack}} = \frac{\sum_{i=1}^{n} \lambda_{\text{team}_i, \text{auswärts,attack}}}{n}
\]

Die Berechnung für \( \lambda_{\text{defense}} \) erfolgt analog.

---

#### **1.3 Berechnung von \( \alpha \):**
Für jedes Team:

\[
\alpha_{\text{team,heim}} = \frac{\lambda_{\text{team,heim,attack}}}{\lambda_{\text{avg,heim,attack}}}
\]
\[
\alpha_{\text{team,auswärts}} = \frac{\lambda_{\text{team,auswärts,attack}}}{\lambda_{\text{avg,auswärts,attack}}}
\]

Damit wird der Heim- bzw. Auswärtsfaktor standardisiert und vergleichbar.

---

### **2. Implementierung des vollständigen Prozesses in Python**

Hier ein erweiterter Python-Code zur Kalibrierung und Nutzung von \( \lambda \) und \( \alpha \):

```python
import numpy as np
import pandas as pd

# Beispiel-Daten: Team und Tore (historisch)
data = {
    "Team": ["TeamA", "TeamB", "TeamC"],
    "Tore_Heim": [30, 25, 28],
    "Spiele_Heim": [15, 15, 15],
    "Tore_Auswärts": [20, 18, 22],
    "Spiele_Auswärts": [15, 15, 15],
    "Gegentore_Heim": [10, 12, 14],
    "Gegentore_Auswärts": [15, 18, 16],
}

# Daten in DataFrame laden
df = pd.DataFrame(data)

# Lambda berechnen (Offensiv- und Defensivstärken)
df["lambda_heim_attack"] = df["Tore_Heim"] / df["Spiele_Heim"]
df["lambda_auswärts_attack"] = df["Tore_Auswärts"] / df["Spiele_Auswärts"]
df["lambda_heim_defense"] = df["Gegentore_Heim"] / df["Spiele_Heim"]
df["lambda_auswärts_defense"] = df["Gegentore_Auswärts"] / df["Spiele_Auswärts"]

# Durchschnittliche Lambda-Werte berechnen
lambda_avg = {
    "heim_attack": df["lambda_heim_attack"].mean(),
    "auswärts_attack": df["lambda_auswärts_attack"].mean(),
    "heim_defense": df["lambda_heim_defense"].mean(),
    "auswärts_defense": df["lambda_auswärts_defense"].mean(),
}

# Alpha berechnen
df["alpha_heim"] = df["lambda_heim_attack"] / lambda_avg["heim_attack"]
df["alpha_auswärts"] = df["lambda_auswärts_attack"] / lambda_avg["auswärts_attack"]

# Ergebnisse anzeigen
print(df[["Team", "lambda_heim_attack", "lambda_auswärts_attack", "alpha_heim", "alpha_auswärts"]])
```

---

### **3. Verwendung der Parameter für Vorhersagen**

Nachdem \( \lambda \) und \( \alpha \) kalibriert wurden, kannst du sie für Vorhersagen nutzen. Zum Beispiel:

#### **Vorhersage der Torwahrscheinlichkeit in einem Heimspiel:**

\[
P(\text{Tor Heimteam}) = \lambda_{\text{heim,attack}} \cdot \alpha_{\text{heim}}
\]

#### **Beispiel:**

```python
# Vorhersage für ein spezifisches Heimspiel von TeamA
team = df[df["Team"] == "TeamA"]
torwahrscheinlichkeit_heim = team["lambda_heim_attack"].values[0] * team["alpha_heim"].values[0]
print(f"Torwahrscheinlichkeit Heimteam (TeamA): {torwahrscheinlichkeit_heim:.2f}")
```

---

### **4. Erweiterungen**
1. **Zeitabhängigkeit:** Modifiziere \( \lambda \) dynamisch während des Spiels (z. B. basierend auf Risikoverhalten).  
2. **Gewichtung älterer Daten:** Schätze \( \lambda \) aus gewichteten Daten, um aktuelle Trends stärker zu berücksichtigen.  
3. **Simulationen:** Simuliere Spiele basierend auf den kalibrierten Parametern und analysiere, wie gut das Modell historische Ergebnisse vorhersagt.

---

Soll ich diese Schritte für eine Simulation, Risikoverhalten oder eine konkrete Anwendung weiter ausbauen?

---

## Modell mit Lambda, Alpha, Tordifferenz und Restzeit

Hier ist ein detaillierter Ansatz zur Integration von \( \lambda \), \( \alpha \), Tordifferenz und verbleibender Restzeit in ein Modell zur Vorhersage von Torwahrscheinlichkeiten während eines Fußballspiels.

---

### **Modellidee**

1. **Parameterübersicht:**
   - \( \lambda_{\text{attack}} \), \( \lambda_{\text{defense}} \): Baseline-Offensiv- und Defensivstärken eines Teams.
   - \( \alpha_H \), \( \alpha_A \): Heim- und Auswärtsmodifikatoren für die Baseline-Werte.
   - \( \Delta_t \): Aktuelle Tordifferenz (\( \text{Tore Heimteam} - \text{Tore Auswärtsteam} \)).
   - \( T_r \): Verbleibende Zeit im Spiel (z. B. in Minuten oder 5-Minuten-Slots).
   - \( R_t \): Risikofaktor, der das Verhalten eines Teams in Abhängigkeit von \( \Delta_t \) und \( T_r \) modelliert.

2. **Grundidee zur Torwahrscheinlichkeit:**
   Die Wahrscheinlichkeit eines Tores wird beeinflusst durch:
   - Die baseline \( \lambda \), angepasst durch \( \alpha \),
   - Die aktuelle Spielsituation (\( \Delta_t \)),
   - Die verbleibende Zeit (\( T_r \)),
   - Einen risikobasierten Modifikator \( R_t \).

3. **Formeln:**
   \[
   \lambda_{\text{effektiv, Heim}} = \lambda_{\text{attack, Heim}} \cdot \alpha_H \cdot R_t
   \]
   \[
   \lambda_{\text{effektiv, Auswärts}} = \lambda_{\text{attack, Auswärts}} \cdot \alpha_A \cdot R_t
   \]

   Der Risikofaktor \( R_t \) kann z. B. durch eine Funktion wie folgt definiert werden:
   \[
   R_t = 1 + c \cdot \frac{\max(0, -\Delta_t)}{T_r + 1}
   \]
   wobei \( c \) ein Kalibrierungsparameter ist, der die Stärke des Risikoverhaltens steuert.

---

### **Python-Implementierung**

Hier ist ein Codebeispiel für die Vorhersage von Torwahrscheinlichkeiten während eines Spiels:

```python
import numpy as np
import pandas as pd

# Beispielhafte Teamdaten
teams = {
    "TeamA": {"lambda_attack": 1.8, "lambda_defense": 1.2, "alpha_H": 1.2, "alpha_A": 0.8},
    "TeamB": {"lambda_attack": 1.5, "lambda_defense": 1.3, "alpha_H": 1.1, "alpha_A": 1.0},
}

# Risikofaktor berechnen
def calculate_risk_factor(delta_t, T_r, c=0.5):
    """Berechnet den Risikofaktor basierend auf Tordifferenz und verbleibender Zeit."""
    return 1 + c * max(0, -delta_t) / (T_r + 1)

# Effektive Lambda berechnen
def calculate_effective_lambda(team, delta_t, T_r, is_home):
    """Berechnet die effektive Lambda für ein Team."""
    # Grundwerte
    lambda_attack = team["lambda_attack"]
    alpha = team["alpha_H"] if is_home else team["alpha_A"]
    
    # Risikofaktor
    R_t = calculate_risk_factor(delta_t, T_r)
    
    # Effektives Lambda
    return lambda_attack * alpha * R_t

# Spielsimulation: Vorhersage der Torwahrscheinlichkeit
def predict_goal_probabilities(team_home, team_away, delta_t, T_r):
    """Berechnet die Wahrscheinlichkeiten eines Tores für Heim- und Auswärtsteam."""
    lambda_home = calculate_effective_lambda(team_home, delta_t, T_r, is_home=True)
    lambda_away = calculate_effective_lambda(team_away, -delta_t, T_r, is_home=False)
    
    # Wahrscheinlichkeiten für Tore
    P_home_goal = lambda_home / (lambda_home + lambda_away)
    P_away_goal = lambda_away / (lambda_home + lambda_away)
    return P_home_goal, P_away_goal

# Beispielhafte Spielsituation
delta_t = 1  # Heimteam führt mit 1 Tor
T_r = 10     # Verbleibende Zeit in 5-Minuten-Slots

# Wahrscheinlichkeiten berechnen
P_home, P_away = predict_goal_probabilities(teams["TeamA"], teams["TeamB"], delta_t, T_r)

print(f"Wahrscheinlichkeit Tor Heimteam: {P_home:.2f}")
print(f"Wahrscheinlichkeit Tor Auswärtsteam: {P_away:.2f}")
```

---

### **Erweiterungen**

1. **Kalibrierung von \( R_t \):**
   - Die Konstante \( c \) kann durch historische Daten optimiert werden, um das Risikoverhalten realistisch zu modellieren.

2. **Simulation des Spiels:**
   - Simuliere den Spielverlauf durch wiederholte Berechnung der Torwahrscheinlichkeiten für jeden Zeitslot. Aktualisiere \( \Delta_t \) und \( T_r \) in jedem Schritt.

3. **Berücksichtigung von Defensivstärken:**
   - Modifiziere \( \lambda_{\text{attack}} \) basierend auf der Defensivstärke des Gegners.

4. **Berücksichtigung von Nachspielzeit:**
   - Passe \( T_r \) dynamisch an, um unerwartete Nachspielzeiten zu berücksichtigen.

---

### **Ergebnisse interpretieren**
Die Wahrscheinlichkeiten \( P_{\text{Home Goal}} \) und \( P_{\text{Away Goal}} \) ändern sich dynamisch je nach Spielstand (\( \Delta_t \)) und verbleibender Zeit (\( T_r \)). Der Ansatz kann genutzt werden für:
- **Live-Spielvorhersagen:** Wie wahrscheinlich ist das nächste Tor?  
- **Spielanalyse:** Wie beeinflusst das Risikoverhalten den Spielverlauf?

---

Soll ich noch die Simulation eines vollständigen Spiels hinzufügen oder bestimmte Details weiter ausbauen?